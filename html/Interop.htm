<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Interop with Direct2D</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="Interop" /><meta name="Description" content="Win2D is implemented as a layer on top of http://msdn.microsoft.com/en-us/library/windows/desktop/dd370990Direct2D, and supports interop in both directions. If you have a Win2D object, you can access the native Direct2D object that is used to implement it." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Win2D documentation<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="Introduction.htm" title="Win2D documentation" tocid="roottoc">Win2D documentation</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="Introduction.htm" title="Introduction" tocid="Introduction">Introduction</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="QuickStart.htm" title="Quick start" tocid="QuickStart">Quick start</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas.htm" title="Microsoft.Graphics.Canvas" tocid="N_Microsoft_Graphics_Canvas">Microsoft.Graphics.Canvas</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_Brushes.htm" title="Microsoft.Graphics.Canvas.Brushes" tocid="N_Microsoft_Graphics_Canvas_Brushes">Microsoft.Graphics.Canvas.Brushes</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_DirectX.htm" title="Microsoft.Graphics.Canvas.DirectX" tocid="N_Microsoft_Graphics_Canvas_DirectX">Microsoft.Graphics.Canvas.DirectX</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_DirectX_Direct3D11.htm" title="Microsoft.Graphics.Canvas.DirectX.Direct3D11" tocid="N_Microsoft_Graphics_Canvas_DirectX_Direct3D11">Microsoft.Graphics.Canvas.DirectX.Direct3D11</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_Effects.htm" title="Microsoft.Graphics.Canvas.Effects" tocid="N_Microsoft_Graphics_Canvas_Effects">Microsoft.Graphics.Canvas.Effects</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_Geometry.htm" title="Microsoft.Graphics.Canvas.Geometry" tocid="N_Microsoft_Graphics_Canvas_Geometry">Microsoft.Graphics.Canvas.Geometry</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_Numerics.htm" title="Microsoft.Graphics.Canvas.Numerics" tocid="N_Microsoft_Graphics_Canvas_Numerics">Microsoft.Graphics.Canvas.Numerics</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_Text.htm" title="Microsoft.Graphics.Canvas.Text" tocid="N_Microsoft_Graphics_Canvas_Text">Microsoft.Graphics.Canvas.Text</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_UI.htm" title="Microsoft.Graphics.Canvas.UI" tocid="N_Microsoft_Graphics_Canvas_UI">Microsoft.Graphics.Canvas.UI</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas_UI_Xaml.htm" title="Microsoft.Graphics.Canvas.UI.Xaml" tocid="N_Microsoft_Graphics_Canvas_UI_Xaml">Microsoft.Graphics.Canvas.UI.Xaml</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="N_System_Numerics.htm" title="System.Numerics" tocid="N_System_Numerics">System.Numerics</a></div><div class="toclevel1" data-toclevel="1"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="WindowsNumerics.htm" title="Windows.Foundation.Numerics" tocid="WindowsNumerics">Windows.Foundation.Numerics</a></div><div class="toclevel1 current" data-toclevel="1"><a data-tochassubtree="false" href="Interop.htm" title="Interop with Direct2D" tocid="Interop">Interop with Direct2D</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="DPI.htm" title="DPI and DIPs" tocid="DPI">DPI and DIPs</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="PixelFormats.htm" title="Pixel formats" tocid="PixelFormats">Pixel formats</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="PremultipliedAlpha.htm" title="Premultiplied alpha" tocid="PremultipliedAlpha">Premultiplied alpha</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="EffectPrecision.htm" title="Effect precision and clamping" tocid="EffectPrecision">Effect precision and clamping</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="LoadingResourcesOutsideCreateResources.htm" title="Loading resources outside of CreateResources" tocid="LoadingResourcesOutsideCreateResources">Loading resources outside of CreateResources</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="RefCycles.htm" title="Avoiding memory leaks" tocid="RefCycles">Avoiding memory leaks</a></div><div class="toclevel1" data-toclevel="1"><a data-tochassubtree="false" href="UAP.htm" title="Windows 10 support" tocid="UAP">Windows 10 support</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize"><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize"></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">Interop with Direct2D</td></tr></table><span class="introStyle"></span><div class="introduction"><p>
        Win2D is implemented as a layer on top of 
        <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd370990" target="_blank">Direct2D</a>,
        and supports interop in both directions. If you have a Win2D object, you can
        access the native Direct2D object that is used to implement it. If you have a Direct2D 
        object, you can look up the Win2D object that wraps it, or create a new wrapper 
        if one did not already exist.
      </p><p>
        Interop allows you to mix and match Win2D with native DirectX APIs. You can write
        an app that mostly uses Win2D, but drop down to native DirectX at any point -
        perhaps to call into some other API or 3rd party component that requires native interfaces.
        Or your app can be mostly native DirectX, yet you can switch over to Win2D in specific
        places where you want its extra convenience or C# support.
      </p></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Interop APIs</span></div><div id="ID1RBSection" class="collapsibleSection"><p>To move back and forth between Win2D and native Direct2D interfaces, use the C++/CX methods:</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACABAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EACABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">// header: Microsoft.Graphics.Canvas.native.h</span>
<span class="highlight-comment">// namespace: Microsoft::Graphics::Canvas</span>

template&lt;typename WRAPPER&gt;
WRAPPER^ GetOrCreate(IUnknown* resource);

template&lt;typename WRAPPER&gt;
WRAPPER^ GetOrCreate(CanvasDevice^ device, IUnknown* resource);

template&lt;typename WRAPPER&gt;
WRAPPER^ GetOrCreate(ID2D1Device1* device, IUnknown* resource);

template&lt;typename T, typename U&gt;
Microsoft::WRL::ComPtr&lt;T&gt; GetWrappedResource(U^ wrapper);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACABAAA");</script><p>
          GetOrCreate returns an existing wrapper instance if one already exists, or creates a new
          wrapper if one does not. Calling it repeatedly on the same native object will return the
          same wrapper each time, as long as that wrapper instance continues to exist. If all references
          to the wrapper are released such that its reference count goes to zero and it is destroyed,
          any later call to GetOrCreate will have to create a new wrapper.
        </p><p>
          Depending on the wrapper type, a CanvasDevice or ID2D1Device may need
          to be passed in to GetOrCreate().
        </p></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Examples</span></div><div id="ID2RBSection" class="collapsibleSection"><p>First include the necessary headers and namespaces:</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAGAAAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAGAAAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAGAAAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-preprocessor">#include</span> &lt;Microsoft.Graphics.Canvas.native.h&gt;
<span class="highlight-preprocessor">#include</span> &lt;d2d1_2.h&gt;

<span class="highlight-keyword">using</span> <span class="highlight-keyword">namespace</span> Microsoft::Graphics::Canvas;
<span class="highlight-keyword">using</span> <span class="highlight-keyword">namespace</span> Microsoft::WRL;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAGAAAAA");</script><p>To get the native Direct2D object that is wrapped by a Win2D object:</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAEAAAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAEAAAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAEAAAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">CanvasDevice^ canvasDevice = ...;

ComPtr&lt;ID2D1Device&gt; nativeDevice = GetWrappedResource&lt;ID2D1Device&gt;(canvasDevice);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAEAAAAA");</script><p>To get a Win2D object wrapping a native Direct2D object:</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACAAAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EACAAAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACAAAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">ComPtr&lt;ID2D1Device&gt; nativeDevice = ...;

CanvasDevice^ canvasDevice = GetOrCreate&lt;CanvasDevice&gt;(nativeDevice.Get());</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACAAAAA");</script><p>Types such as CanvasBitmap require that the device is passed to GetOrCreate:</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAAAAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAAAAAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAAAAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">ComPtr&lt;ID2D1Bitmap1&gt; nativeBitmap = ...;

CanvasBitmap^ bitmap = GetOrCreate&lt;CanvasBitmap&gt;(canvasDevice, nativeBitmap.Get());</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAAAAAA");</script></div></div></div><div id="pageFooter" class="pageFooter"><p><a href="http://github.com/Microsoft/Win2D/blob/master/LICENSE.txt" target="_blank">Copyright (c) Microsoft Corporation. All rights reserved.</a></p></div></body></html>