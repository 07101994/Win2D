<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--

    This file contains build system properties that are common between C# and
    C++ projects.

  -->

  <PropertyGroup>
    <DeviceType Condition="'$(TargetPlatformIdentifier)' == 'WindowsPhoneApp'">Phone</DeviceType>
    <DeviceType Condition="'$(DeviceType)' == ''">$(TargetPlatformIdentifier)</DeviceType>
  </PropertyGroup>

  <PropertyGroup>
    <__Platform Condition="'$(Platform)' == 'Win32'">x86</__Platform>
    <__Platform Condition="'$(Platform)' != 'Win32'">$(Platform)</__Platform>
  </PropertyGroup>

  <PropertyGroup>
    <FullPlatform>$(DeviceType)$(__Platform)</FullPlatform>
  </PropertyGroup>

  <PropertyGroup>
    <BinariesDirectory Condition="'$(TF_BUILD_BINARIESDIRECTORY)' == ''">$(MSBuildThisFileDirectory)..\bin</BinariesDirectory>
    <BinariesDirectory Condition="'$(TF_BUILD_BINARIESDIRECTORY)' != ''">$(TF_BUILD_BINARIESDIRECTORY)</BinariesDirectory>
  </PropertyGroup>

  <PropertyGroup>
    
    <!--

        <__OutputPath> is used to initialize <OutputPath> for C# and <OutDir> for C++.

        Every project gets its own directory to put its artifacts in.  This is
        particularly important for Store apps since these will have files with
        the same name (eg AppXManifest.xml) that are different for each project.

    -->

    <__OutputPath>$(BinariesDirectory)\$(FullPlatform)\$(Configuration)\$(MSBuildProjectName)</__OutputPath>
    <BaseIntermediateOutputPath>$(MSBuildThisFileDirectory)..\obj\$(MSBuildProjectName)\$(FullPlatform)\$(Configuration)\</BaseIntermediateOutputPath>

    <!-- TODO: MakeRelative shouldn't be necessary, but the .NET native build tools assume IntermediateOutputPath is relative to MSBuildProjectDirectory -->
    <IntermediateOutputPath>$([MSBuild]::MakeRelative($(MSBuildProjectDirectory), $(BaseIntermediateOutputPath)))</IntermediateOutputPath>

    <AssetDir>$(MSBuildThisFileDirectory)assets\</AssetDir>
  </PropertyGroup>

  <!-- 
       This does some work that should be done in c:/Program Files
       (x86)/MSBuild/14.0/Microsoft.Common.Targets/ImportBefore/Windows.8.1.UT_SDKReference.props.
       While we're waiting for this, we can do it ourselves. 
       
       TODO: WorkaroundModifyUnitTestPlatformVersion can be removed when the workaround is added to VS2015.
  -->

  <Target Name="WorkaroundModifyUnitTestPlatformVersion" BeforeTargets="ResolveSDKReferences" AfterTargets="ModifyUnitTestPlatformVersion" Condition="'$(UnitTestPlatformVersion)' != ''">
    <ItemGroup>

      <SDKReference Include="CppUnitTestFramework, Version=$(UnitTestPlatformVersion)" Condition="'$(PlatformToolset)' != '' and '%(SDKReference.Identity)' == 'CppUnitTestFramework, Version=11.0'" />
      <SDKReference Include="MSTestFramework, Version=$(UnitTestPlatformVersion)"  Condition="'$(PlatformToolset)' == '' and '%(SDKReference.Identity)' == 'MSTestFramework, Version=11.0'" />
      <SDKReference Include="TestPlatform, Version=$(UnitTestPlatformVersion)" Condition="'%(SDKReference.Identity)' == 'TestPlatform, Version=11.0'" />
      
      <SDKReference Remove="CppUnitTestFramework, Version=11.0"/>
      <SDKReference Remove="MSTestFramework, Version=11.0"/>
      <SDKReference Remove="TestPlatform, Version=11.0" />
    </ItemGroup>
  </Target>

  <!--
       TODO: remove this workaround once DEVDIV:1122911 is fixed
  -->
  <PropertyGroup>
    <!-- The SDKExtensionDirectoryRoot that we're fixing here is conditioned on
         SDKTargetReferenceDirectoryRoot being not-empty.  That is the only
         reference to SDKTargetReferenceDirectoryRoot I can find, so just
         setting it to a random value is enough to allow us to override
         SDKExtensionDirectoryRoot.
    -->
    <SDKTargetReferenceDirectoryRoot>Please let me override SDKExtensionDirectoryRoot, thank you.</SDKTargetReferenceDirectoryRoot>
    <SDKExtensionDirectoryRoot>$(MSBuildProgramFiles32)\Windows Kits\10;$(LocalAppData)\$(SDKIdentifier)\$(SDKVersion);$(MSBuildProgramFiles32)\$(SDKIdentifier)\$(SDKVersion)</SDKExtensionDirectoryRoot>
  </PropertyGroup>
      

</Project>
